---
import ListarProductos from "../../components/ListarProductos.astro";
import Layout from "../../layouts/Layout.astro";
import { countCategories } from "../../utils/countCategories";
import { cargarProductos } from "../../utils/loadCSV";

/** Genera los archivos html por cada categorÃ­a */
export const getStaticPaths = () => {
  const products = cargarProductos();
  const categories = countCategories(products);
  return categories.map((c) => ({
    params: { id: c.name },
    props: { products },
  }));
};

const { id } = Astro.params;
const { products } = Astro.props;
const filteredProducts = products.filter((p) =>
  p.categories.some((cat) => cat === id)
);
---

<Layout categorySelected={id}>
  <ListarProductos products={filteredProducts} />
</Layout>
